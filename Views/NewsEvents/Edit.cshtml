@model UAAAS.Models.jntuh_newsevents
@{
    ViewBag.Title = "Edit News/Events";
}

<h2>Edit News/Events</h2>

<script src="@Url.Content("~/Scripts/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>

@using (Html.BeginForm("Edit", "NewsEvents", FormMethod.Post, new { enctype = "multipart/form-data" }))
{
    @Html.ValidationSummary(true)
    if (TempData["Error"] != null)
    {
    <div class="error">
        <p><strong>Error:</strong> @TempData["Error"].ToString()</p>
    </div>
    }
    if (TempData["Success"] != null)
    {
    <div class="success">
        <p><strong>Success:</strong> @TempData["Success"].ToString()</p>
    </div>
    }
    <div class="details_table">

        @Html.HiddenFor(model => model.id)

        <div class="editor-label">
            @Html.LabelFor(model => model.isNews)
        </div>
        <div class="editor-field">
            <label>@Html.RadioButtonFor(model => model.isNews, true) For all</label>
            <label>@Html.RadioButtonFor(model => model.isNews, false) For colleges</label>
            @Html.ValidationMessageFor(model => model.isNews)
        </div>

        <div class="editor-label">
            @Html.LabelFor(model => model.title)
        </div>
        <div class="editor-field">
            @Html.TextAreaFor(model => model.title)
            @Html.ValidationMessageFor(model => model.title)
        </div>

        <div class="editor-label">
            @Html.LabelFor(model => model.navigateURL)
        </div>
        <div class="editor-field">
            @Html.EditorFor(model => model.navigateURL)
            @Html.ValidationMessageFor(model => model.navigateURL)
        </div>

        <div class="editor-label">
            <label>Upload File</label>
        </div>
        <div class="editor-field files">
            @Html.TextBoxFor(model => model.uploadFile, new { type = "file", @class = "file" })<span style="color: red;"></span><br />
        </div>

        <div class="editor-label">
            @Html.LabelFor(model => model.startDate)
        </div>
        <div class="editor-field">
            @Html.TextBoxFor(model => model.startDate, new { @class = "newsEventsCalendar" })
            @Html.ValidationMessageFor(model => model.startDate)
        </div>
        <div class="editor-label">
            @Html.LabelFor(model => model.endDate)
        </div>
        <div class="editor-field">
            @Html.TextBoxFor(model => model.endDate, new { @class = "newsEventsCalendar" })
            @Html.ValidationMessageFor(model => model.endDate)
        </div>

        <div class="editor-label">
            @Html.LabelFor(model => model.isActive)
        </div>
        <div class="editor-field">
            <label>@Html.RadioButtonFor(model => model.isActive, true) Active</label>
            <label>@Html.RadioButtonFor(model => model.isActive, false) Inactive</label>
            @Html.ValidationMessageFor(model => model.isActive)
        </div>

        <div class="editor-label">
            @*@Html.LabelFor(model => model.newsOrder)*@
            Show Latest News Image
        </div>
        <div class="editor-field">
            @Html.EditorFor(model => model.newsOrder)
            @Html.ValidationMessageFor(model => model.newsOrder)
            Note : 1 - Yes, 0 - No
        </div>
        @Html.HiddenFor(model => model.createdOn)
        @Html.HiddenFor(model => model.createdBy)

        @Html.HiddenFor(model => model.updatedOn, new { Value = DateTime.Now })
        @Html.HiddenFor(model => model.updatedBy, new { Value = Convert.ToInt32(Membership.GetUser(HttpContext.Current.User.Identity.Name).ProviderUserKey) })
        <div class="editor-label last-row">
            &nbsp;
        </div>
        <div class="editor-field last-row">
            <p>
                @Html.ActionLink("Back", "Index", null, new { @class = "back_button" })
                <input type="submit" value="Save" onclick="return Validate();" />
            </p>
        </div>
    </div>
}

<script type="text/javascript">
    $(document).ready(function () {
        $('.newsEventsCalendar').datepicker({
            dateFormat: 'mm/dd/yy',
            changeMonth: true,
            changeYear: true,
            showOn: "button",
            buttonImage: "@Url.Content("~/Content/themes/base/images/calendar.gif")",
            buttonImageOnly: true
        });
    });
    function Validate() {
        var isValidUrl = true;
        var isValidTitle = true;
        var uploadedFile = $("#uploadFile").val();
        var navigationUrl = $("#navigateURL").val();
        if (uploadedFile != '' && navigationUrl != '') {
            alert("Please Select Either Navigation Url Or Uploaded file");
            isValidUrl = false;
        }
        else {
            isValidUrl = true;
        }
        var title = $("#title").val();
        if (title == '') {
            alert("Please Select Title");
            isValidTitle = false;
        }
        else {
            isValidTitle = true;
        }
        return isValidTitle && isValidUrl;
    }

    //get file size
    function GetFileSize(fileid) {
        try {
            var fileSize = 0;
            //for IE
            if ($.browser.msie) {
                //before making an object of ActiveXObject, 
                //please make sure ActiveX is enabled in your IE browser
                var objFSO = new ActiveXObject("Scripting.FileSystemObject"); var filePath = $("#uploadFile")[0].value;
                var objFile = objFSO.getFile(filePath);
                var fileSize = objFile.size; //size in kb
                fileSize = fileSize / 1048576; //size in mb 
            }
                //for FF, Safari, Opeara and Others
            else {
                fileSize = $("#uploadFile")[0].files[0].size //size in kb
                fileSize = fileSize / 1048576; //size in mb 
            }
            return fileSize;
        }
        catch (e) {
            alert(e);
            //alert("Error is : " + e);
        }
    }

    //get file path from client system
    function getNameFromPath(strFilepath) {
        var objRE = new RegExp(/([^\/\\]+)$/);
        var strName = objRE.exec(strFilepath);

        if (strName == null) {
            return null;
        }
        else {
            return strName[0];
        }
    }

    $(function () {
        $(".file").change(function () {

            var file = getNameFromPath($(this).val());

            var flag;
            if (file != null) {
                var extension = file.substr((file.lastIndexOf('.') + 1));

                switch (extension) {
                    case 'xls':
                    case 'XLS':
                    case 'xlsx':
                    case 'XLSX':
                    case 'doc':
                    case 'DOC':
                    case 'docx':
                    case 'DOCX':
                    case 'pdf':
                    case 'PDF':
                        flag = true;
                        break;
                    default:
                        flag = false;
                }
            }

            if (flag == false) {
                $(".files > span").text("You can upload only Word documents, Excel Sheets, Pdf files");
                return false;
            }
            else {

                var size = GetFileSize(file);
                if (size > 3) {
                    $(".files > span").text("You can upload file up to 3 MB");
                }
                else {
                    $(".files > span").text("");
                }
            }
        });
    });
</script>
