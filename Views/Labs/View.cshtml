@*@model IList<UAAAS.Models.Lab>*@
@using UAAAS.Models;
@{
    uaaasDBContext db = new uaaasDBContext();
    ViewBag.Title = "Laboratories";
    Layout = "~/Views/Shared/_LayoutLeftMenu.cshtml";
    //if (Roles.IsUserInRole("Admin") || Roles.IsUserInRole("DataEntry"))
    //{
    //    Layout = "~/Views/Shared/_DataEntryLayoutLeftMenu.cshtml";
    //}
    int count = 0;
}


<script src="@Url.Content("~/Scripts/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/Validations.js")" type="text/javascript"></script>
<link href="~/Scripts/Jquerydatatables/jquery.dataTables.min.css" rel="stylesheet" />
<script src="~/Scripts/Jquerydatatables/jquery.dataTables.min.js"></script>
<script src="~/Scripts/Jquerydatatables/dataTables.bootstrap.min.js"></script>


<style>
    #example_wrapper .row {
        border: none;
    }

    #example_filter input[type=search] {
        border: solid 1px #c0c0c0;
        padding: 2px;
    }

    #example thead tr th, #example tfoot tr th {
        border: 1px solid #d3d3d3;
    }

    /*#example tbody tr td {
        text-align: center;
    }*/
    #example_wrapper {
        border: 1px solid #C0C0C0;
    }
    #example {
        padding-top: 10px;
    }
</style>

<script type="text/javascript">
    $(document).ready(function() {
        

        $("#degreeIds").change(function () {
             
            var selectedValue = $(this).val();
            if (selectedValue != null && selectedValue != "") {
                 
                $.ajax({
                    type: "GET",
                    contentType: "application/json",
                    url: "/Labs/GetDepartments?degreeId=" + selectedValue,
                    // data: "{}",
                    dataType: "Json",
                    success: function (data) {
                        // console.log(data);
                        // first remove the current options if any
                        $("#Departments").find('option').remove();
                        var item = "<option value=''>---Select---</option>";
                        // next iterate thru your object adding each option to the drop down\    
                        // $(data).each(function (index, item) { // GETTING ERROR HERE
                        $.each(data.Data, function (i, state) {
                             
                            item += "<option value='" + state.DeptId + "'>" + state.DeptName + "</option>";
                            // $("#Departments").append($('<option></option>').val(item.Value).html(item.Text));
                        });
                        $("#Departments").html(item);

                    },
                    error: function ajaxError(response) {
                        alert(response.status + ' ' + response.statusText);
                    }
                });
            }
        });


        $("#Departments").change(function () {
            debugger;
            var selectedDegreeId = $("#degreeIds option:selected").val();
            var selectedDepartmentId = $(this).val();
            if (selectedDegreeId != null && selectedDegreeId != "" && selectedDepartmentId != null && selectedDepartmentId != "") {
                $("#example").show();
                DataTable(selectedDegreeId, selectedDepartmentId);
            } else {
                $("#example").hide();
            }
        });


       

    });
    function DataTable(degreeId, departmentId) {
         
        var otable = $('#example').DataTable({
            "processing": true,
            //"serverSide": true,
            "stateSave": true,
            "bDestroy": true,
            // "paging": false,
            // "ordering": false,
            "searching": false,
            "ajax":
            {
                "type": "POST",
                "url": "/Labs/LabsJson?DegreeId=" + degreeId + "&DepartmentId=" + departmentId,
                "dataSrc": ""
            },
            "columns": [
                {
                    "data": "id",
                    render: function (data, type, row, meta) {
                        return meta.row + meta.settings._iDisplayStart + 1;
                    }
                },
                { "data": "specializationName" },
                 { "data": "year" },
                { "data": "Semester" },
               
                { "data": "Labcode" },
                { "data": "LabName" },
                { "data": "EquipmentName" },
                {
                    render: function (data, type, full, meta, row) {
                         
                        //var eqid = full.EquipmentID;
                        //var id = full.id;
                        //var EquipmentNo = full.EquipmentNo;
                        //var collegeId = full.collegeId;
                        var count = full.ExpCount;
                        if (count > 0) {
                             
                            return '<input type="radio" checked="true" value="True"  disabled="disabled" name="Availability' + meta.row + '"  id="' + full.id + '"  eqpid = "' + full.EquipmentID + '" eqpno = "' + full.EquipmentNo + '"  class="editDialog"/>Yes&nbsp;&nbsp;<input type="radio"  disabled="disabled" name="Availability' + meta.row + '" value="False"   id ="' + full.id + '" eqpid = "' + full.EquipmentID + '" eqpno ="' + full.EquipmentNo + '" class="confirmDialog delete1">No</input>';
                        } else {
                            return '<input type="radio"  value="True"   disabled="disabled" name="Availability' + meta.row + '"  eqpid = "' + full.EquipmentID + '"  eqpno = "' + full.EquipmentNo + '"  class="editDialog" />Yes&nbsp;&nbsp;<input type="radio" value="False" checked="true"  disabled="disabled" name="Availability' + meta.row + '"    eqpid = "' + full.EquipmentID + '"   eqpno = "' + full.EquipmentNo + '"  class="confirmDialog delete1">No</input>';
                        }
                    }


                }
                //{ "data": "EquipmentName" } 
                //  {
                //      "render": function (data, type, full) {
                //          return '<a href="/Faculty/FacultyRegistrationNumber?fid=' + full["id"] + '" class ="EditDialog edit_button" style="text-align:center"><span>Edit</span></a>';
                //      }
                //  },
                //   {
                //       "render": function (data, type, full) {
                //           return '<a href="/Faculty/Delete?fid=' + full["id"] + '&&type=' + full["facultyTypeId"] + '&&rid=' + full["facultyCategoryId"] + '"  class="confirmDialog delete_button"><span>Delete</span></a>';
                //       }
                //   },
                //{
                //    "render": function (data, type, full) {

                //        return '<a href="/Faculty/ViewFacultyDetails?fid=' + full["id"] + ' " target="_blank" class="view_button"><span>View</span></a>';
                //    }
                //}
            ]
            //"createdRow": function (row, data, index) {
            //     
            //    if (data["SpecializationName"] === null || data["department"] === null) {
            //        $('td:eq(0)', row).css("background-color", "red");
            //    }
            //}
        });

        //$('#example tfoot tr th').each(function(i) {
        //    if (i !== 8 && i !== 9 && i !== 0) {
        //        var title = $(this).text();
        //        $(this).html('<input type="text" placeholder="" />');
        //    }
        //});
        //otable.columns().every(function() {
        //    var column = this;
        //    $('input', this.footer()).on('keyup change', function() { column.search(this.value).draw(); });
        //});
        //otable.on('order.dt search.dt', function() {
        //    otable.column(0, { search: 'applied', order: 'applied' }).nodes().each(function(cell, i) {
        //        cell.innerHTML = i + 1;
        //    });
        //}).draw();
    }



</script>




@using (Html.BeginForm())
{
    <table width="100%">
        <tr>
            <th class="col1">Degree</th>
            <td class="col2">
                @Html.DropDownList("degreeIds", new SelectList(ViewBag.Degree as System.Collections.IEnumerable, "DegreeId", "DegreeName"), "---Select---", new { style = "width: 200px" })
            </td>
        </tr>
        <tr>
            <th class="col1">Department-Specialization</th>
            <td class="col2">
                @Html.DropDownList("Departments", new List<SelectListItem> { }, "---select---", new { style = "width: 200px" })
            </td>
        </tr>
    </table>
    <br />
    <table id="example" class="webGrid display" style="display: none">
        <thead style="background: #FCF1D1">
            <tr>
                <th style="text-align: left;">S.No</th>
                <th style="text-align: left;">Specialization</th>
                <th style="text-align: left;">Year</th>
                <th style="text-align: left;">Semester</th>
              
                <th style="text-align: left;">Lab Code</th>
                <th style="text-align: left;">Lab Name</th>
                <th style="text-align: center;">Equipment Name</th>
                <th style="text-align: center;">Available</th>
            </tr>
        </thead>


        @*<tfoot style="display:table-header-group">
                <tr>
                    <th>S.No </th>
                    <th>Name</th>
                    <th>Designation</th>
                    <th>Department</th>
                    <th>Faculty Registration Number</th>
                    <th>Verification Status</th>
                    <th>Edit</th>
                    <th>Delete</th>
                </tr>
            </tfoot>*@
        <tbody></tbody>
    </table>
   
}































@*<script type="text/javascript">
    $(document).ready(function () {
        $(".view_hide").show();
        var mainUrl = window.location;
        var url;

        $.ajaxSetup({ cache: false });

        var $myDialog = $("#dialog-edit").dialog({
            title: 'Add/Edit Laboratories',
            autoOpen: false,
            resizable: false,
            height: 400,
            width: 650,
            show: { effect: 'drop', direction: "up" },
            modal: true,
            draggable: true,
            closeOnEscape: true,
            open: function (event, ui) {
                $(this).load(url);
            },
            close: function (event, ui) {
                $(this).dialog("close");
            }
        });

        $(".viewDialog").live("click", function (e) {
            var url = $(this).attr('href');
            $("#dialog-view").dialog({
                title: 'View Laboratories',
                autoOpen: false,
                resizable: false,
                height: 450,
                width: 620,
                show: { effect: 'drop', direction: "up" },
                modal: true,
                draggable: true,
                open: function (event, ui) {
                    $(this).load(url);
                },
                buttons: {
                    "Close": function () {
                        $(this).dialog("close");
                    }
                },
                close: function (event, ui) {
                    $(this).dialog('close');
                }
            });

            $("#dialog-view").dialog('open');
            return false;
        });

        $("#btncancel").live("click", function (e) {
            $("#dialog-edit").dialog("close");
        });

        $($myDialog).bind("dialogclose", function () {
            window.location = mainUrl;
        });
    });

    function printdiv(printpage) {
        $(".view_hide").hide();
        //Get the HTML of div
        var divElements = document.getElementById(printpage).innerHTML;
        //Get the HTML of whole page
        var oldPage = document.body.innerHTML;

        //Reset the page's HTML with div's HTML only
        document.body.innerHTML =
          "<html><head><title></title></head><body>" +
          divElements.fontsize(1) + "</body>";

        //Print Page
        window.print();

        //Restore orignal HTML
        document.body.innerHTML = oldPage;
        $(".view_hide").show();
        return false;
    }
</script>

<div id="div_print">
    <h2>Laboratories</h2>
    @using (Html.BeginForm())
    {
          
        <table class="webGrid" style="width: 100%;">
            <tr style="font-weight: bold;" class="gridHeader">
                <td style="text-align: center; width: 5%;">S.No</td>
                <td style="text-align: left; width: 10%;">Degree</td>
                <td style="text-align: left; width: 10%;">Department</td>
                <td style="text-align: left;">Specialization</td>
                <td style="text-align: left;">Semester</td>
                <td style="text-align: center; width: 5%;">year</td>
                <td style="text-align: left;">Lab Code</td>
                <td style="text-align: left;">Lab Name</td>
                <td style="text-align: left; width: 10%;">Equipment Name</td>
                <td style="text-align: left; width: 10%;">Equipment Photo</td>
                <td style="text-align: left; width: 20%;">Available</td>
            </tr>
            @for (int i = 0; i < Model.Count(); i++)
            {
                <tr>
                    <td style="text-align: center; width: 5%; background-color: #FCF1D1" class="col1">
                        @Html.HiddenFor(m => m[i].id)
                        @Html.HiddenFor(m => m[i].degreeId)
                        @Html.HiddenFor(m => m[i].departmentId)
                        @Html.HiddenFor(m => m[i].specializationId)
                        @Html.HiddenFor(m => m[i].year)
                        @Html.HiddenFor(m => m[i].LabName)
                        @Html.HiddenFor(m => m[i].EquipmentName)
                        @Html.HiddenFor(m => m[i].uploadFile)
                        @Html.HiddenFor(m => m[i].EquipmentNo)
                        @(i + 1)
                    </td>
                    <td style="background-color: #FCF1D1">@Html.DisplayFor(m => m[i].degree)</td>
                    <td style="background-color: #FCF1D1">@Html.DisplayFor(m => m[i].department)</td>
                    <td style="background-color: #FCF1D1">@Html.DisplayFor(m => m[i].specializationName)</td>
                    @if (Model[i].Semester != 0)
                    {
                        <td style="background-color: #FCF1D1">@Html.DisplayFor(m => m[i].Semester)</td>
                    }
                    else
                    {
                        <td style="background-color: #FCF1D1"></td>
                    }
                    @if (Model[i].year != 0)
                    {
                        <td style="background-color: #FCF1D1">@Html.DisplayFor(m => m[i].year)</td>
                    }
                    else
                    {
                        <td style="background-color: #FCF1D1"></td>
                    }
                    <td style="background-color: #FCF1D1">@Html.DisplayFor(m => m[i].Labcode)</td>
                    <td style="background-color: #FCF1D1">@Html.DisplayFor(m => m[i].LabName)</td>
                    <td style="background-color: #FCF1D1">@Html.DisplayFor(m => m[i].EquipmentName)</td>
                    <td style="background-color: #FCF1D1">
                        @if (@Html.DisplayFor(m => m[i].uploadFile) != null && @Html.DisplayFor(m => m[i].uploadFile).ToString() != "")
                        {
                            <img src="../Content/Upload/EquipmentsPhotos/@Html.DisplayFor(m => m[i].uploadFile)" style="height: 50px;" />
                        }
                        else
                        {
                            <img src="../Content/Images/no-photo.gif" style="height: 50px;" />
                        }

                        @Html.DisplayFor(m => m[i].EquipmentName)
                    </td>

                    @{
                    var eqid = Model[i].EquipmentID;
                    var id = Model[i].id;
                    var EquipmentNo = Model[i].EquipmentNo;
                    count = db.jntuh_college_laboratories.Where(l => l.id == id && l.EquipmentNo == EquipmentNo).Select(l => l.id).Count();
                    }

                    @if (count > 0)
                    {
                        <td style="background-color: #FCF1D1">
                            @Html.RadioButton("Availability" + i, true, true, new { id = Model[i].id, eqpid = "undefined", @class = "editDialog", @disabled = "disabled" }) Yes &nbsp;&nbsp; 
                        @Html.RadioButton("Availability" + i, false, new { id = Model[i].id, eqpid = "undefined", @class = "delete", @disabled = "disabled" }) No                        
                        </td>
                    
                    }
                    else
                    {
                        <td style="background-color: #FCF1D1">
                            @Html.RadioButton("Availability" + i, true, new { eqpid = Model[i].EquipmentID, id = DBNull.Value, @class = "editDialog", @disabled = "disabled" }) Yes &nbsp;&nbsp;
                        @Html.RadioButton("Availability" + i, false, true, new { eqpid = Model[i].EquipmentID, id = DBNull.Value, @class = "delete", @disabled = "disabled" }) No
                        </td>
                    }

                </tr>
            }
        </table>
            if (ViewBag.Count == 0)
            {
        <div class="warning" style="width: 200px; margin: 0 auto;">
            <p>No records found</p>
        </div>
            }
        <div id="dialog-view" style="display: none">
        </div>
    }
</div>*@

